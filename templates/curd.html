<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/bs-brain@2.0.3/components/footers/footer-2/assets/css/footer-2.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flask Curd</title>
  </head>
  <style>
    .custom {
      width: 78px !important;
      border: 1px solid black;
    }
    .center {
      margin-left: auto;
      margin-right: auto;
    }
  </style>
  <body>
    <div class="container">
      <h1 class="text-center mt-4">Curd Operation</h1>
      <table id="data-table" class="table mt-4" style="text-align: center;">
        <thead class="table-primary">
          <tr>
            <th>Id</th>
            <th>Userame</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody id="data-body"></tbody>
      </table>
      <form id="myForm" class="mt-4" style="text-align: center;">
        <button type="button" class="btn btn-primary custom" data-bs-toggle="modal" data-bs-target="#myModal">Add</button>
        <button type="button" class="btn btn-warning custom" data-bs-toggle="modal" data-bs-target="#myModal">Update</button>
        <button type="button" class="btn btn-danger custom" data-bs-toggle="modal" data-bs-target="#myModal">Delete</button>
      </form>
    </div>

    <div class="container mt-5">
      <div class="modal" id="myModal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">crud Operation</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
              <form id="myForm" class="mt-4">
                <div class="form-group">
                  <label for="id">Id:</label>
                  <input type="number" class="form-control mb-2" id="id" name="id" required />
                </div>
                <div class="form-group">
                  <label for="username">Username:</label>
                  <input type="text" class="form-control mb-2" id="username" name="username" required />
                </div>
                <div class="form-group">
                  <label for="email">Email:</label>
                  <input type="email" class="form-control mb-2" id="email" name="email" required />
                </div>
                <button type="submit" class="btn btn-primary mt-2" onclick="submitForm()">Submit</button>
              </form>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>

    var jsonData = {{data | tojson}}
        var dataBody = document.getElementById('data-body')
        
        jsonData.forEach(function (item) {
          var tr = document.createElement('tr')
          tr.innerHTML = `<td>${item.id}</td><td>${item.username}</td><td>${item.email}</td>`
          dataBody.appendChild(tr)
        }) 

        function submitForm() {
          var formData = {
            id: $('#id').val(),
            username: $('#username').val(),
            email: $('#email').val()
          }
          $.ajax({
            type: 'POST',
            url: 'postapidata',
            data: JSON.stringify(formData),
            contentType: 'application/json',
            dataType: 'json',
            success: function (data) {
              $('#message').html('<div class="alert alert-success">' + data.message + '</div>')
            },
            error: function () {
              $('#message').html('<div class="alert alert-danger">Error submitting form.</div>')
            }
          })
        }
        
      </script>
</html>
